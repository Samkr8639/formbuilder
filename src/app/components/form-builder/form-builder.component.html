@if (hasForms) {
  <div class="flex h-full">
    <!-- Field Palette - Only for admins -->
    @if (userRole === 'admin' && !isPreviewMode) {
      <div class="w-64 bg-white border-r border-gray-200 p-4 overflow-y-auto">
        <h3 class="font-medium text-gray-700 mb-4">Add Field</h3>
        <div class="grid grid-cols-2 gap-3 addfield-grid-buttons">
          @for (fieldType of fieldTypes; track fieldType.id) {
            <button
              (click)="addField(fieldType.id)"
              class="p-3 bg-white border border-gray-200 rounded-lg flex flex-col items-center justify-center hover:border-primary hover:bg-indigo-50 transition-colors">
              <i [class]="'fas ' + fieldType.icon + ' text-primary text-lg mb-2'"></i>
              <span class="text-sm text-gray-700">{{ fieldType.name }}</span>
            </button>
          }
        </div>
      </div>
    }
    
    <!-- Form Canvas -->
    <div class="flex-1 flex">
      <div [class]="'flex-1 p-6 ' + (isPreviewMode ? 'flex justify-center' : '')">
        <div [class]="isPreviewMode ? 'w-full max-w-3xl' : ''">
          @if (isPreviewMode) {
            <app-form-preview 
              [form]="currentForm" 
              [isPreview]="true"
              (saveToDb)="onSaveToDb($event)" 
            />
          } @else {
            <div class="bg-white rounded-lg border border-gray-200 p-6">
              <!-- Form Header -->
              <div class="mb-6">
                <input 
                  type="text" 
                  [value]="currentForm.title" 
                  (input)="formUpdate.emit({ title: $any($event.target).value })"
                  class="form-control"
                  placeholder="Form Title"
                  [readOnly]="userRole !== 'admin'"
                />
                <textarea 
                  [value]="currentForm.description" 
                  (input)="formUpdate.emit({ description: $any($event.target).value })"
                  class="form-control mt-2"
                  placeholder="Form Description (optional)"
                  rows="2"
                  [readOnly]="userRole !== 'admin'"
                ></textarea>
              </div>
              
              <!-- Form Fields -->
              <div class="space-y-4">
                @if (currentForm.fields.length === 0) {
                  <div class="text-center py-12 border-2 border-dashed border-gray-300 rounded-lg" style="height: 200px;">
                    <div style="display: block; position: relative; top: 33%;">
                      <i class="fas fa-plus-circle text-2xl text-gray-400 mb-3"></i>
                      <p class="text-gray-500">Add form fields from the left panel</p>
                    </div>
                  </div>
                } @else {
                  @for (field of currentForm.fields; track field.id; let index = $index) {
                    <div 
                      class="field-item bg-white border border-gray-200 rounded-lg p-4 relative group"
                      (dragover)="handleDragOver($event)"
                      (drop)="handleDrop($event, index)"
                    >
                      @if (userRole === 'admin') {
                        <div class="absolute -left-10 top-4 flex flex-col space-y-2 opacity-0 group-hover:opacity-100 transition-opacity">
                          <button 
                            class="drag-handle p-1 text-gray-400 hover:text-gray-600"
                            draggable="true"
                            (dragstart)="handleDragStart($event, field)"
                          >
                            <i class="fas fa-grip-vertical"></i>
                          </button>
                          <button 
                            (click)="fieldConfig = field"
                            class="p-1 text-gray-400 hover:text-primary"
                          >
                            <i class="fas fa-cog"></i>
                          </button>
                          <button 
                            (click)="duplicateField(field.id)"
                            class="p-1 text-gray-400 hover:text-primary"
                          >
                            <i class="fas fa-copy"></i>
                          </button>
                          <button 
                            (click)="deleteField(field.id)"
                            class="p-1 text-gray-400 hover:text-red-500"
                          >
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      }
                      
                      <app-form-field 
                        [field]="field" 
                        [isEditing]="userRole === 'admin'"
                        (fieldUpdate)="updateField(field.id, $event)"
                      />
                    </div>
                  }
                }
              </div>
              
              <!-- Add Field Button -->
              @if (userRole === 'admin' && currentForm.fields.length > 0) {
                <div class="mt-6 text-center">
                  <button 
                    (click)="addField('text')"
                    class="inline-flex items-center space-x-2 px-4 py-2 bg-primary text-white rounded-lg hover:bg-indigo-600 transition-colors"
                  >
                    <i class="fas fa-plus"></i>
                    <span>Add Field</span>
                  </button>
                </div>
              }
            </div>
          }
        </div>
      </div>
      
      <!-- Field Configuration Panel -->
      @if (fieldConfig && userRole === 'admin') {
        <app-field-config 
          [field]="fieldConfig" 
          (fieldUpdate)="updateField(fieldConfig.id, $event)"
          (close)="fieldConfig = null"
        />
      }
    </div>
  </div>
}@else{
        <div class="text-center text-gray-500 mt-50 border-2 border-dashed border-gray-300 rounded-lg p-10 no-forms-message">
          <h2>No forms available to add or edit.!!!</h2>
          <p>Please create a new form or edit an existing one.</p>
        </div>
      }