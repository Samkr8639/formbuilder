@if (submitted()) {
<div class="bg-white rounded-lg border border-gray-200 p-8 text-center">
  <i class="fas fa-check-circle text-5xl text-green-500 mb-4"></i>
  <h2 class="text-2xl font-bold text-gray-800 mb-2">Form Submitted Successfully!</h2>
  <p class="text-gray-600 mb-6">Thank you for your submission.</p>
  <button (click)="resetForm()"
    class="bg-primary text-white py-2 px-6 rounded-lg hover:bg-indigo-600 transition-colors">
    Submit Another Response
  </button>
</div>
} @else {
<div class="">
  <div class="bg-white rounded-lg border border-gray-200 p-6 ">
    <div class="mb-6">
      <h1 class="text-2xl font-bold  mb-2" [style.color]="form.theme.primaryColor">{{ form.title }}</h1>
      @if (form.description) {
      <p class="text-gray-600">{{ form.description }}</p>
      }
    </div>

    <form (submit)="handleSubmit($event)">
      <div class="space-y-6">
        @for (field of form.fields; track field.id) {
        <div class="field-item" [class.field-error]="hasFieldError(field.id)">
          <label class="block text-lg font-medium text-gray-800 mb-2">
            {{ field.label }}
            @if (field.required) {
            <span class="text-red-500 ml-1">*</span>
            }
          </label>
          
          <!-- Error Messages Display -->
          @if (hasFieldError(field.id)) {
            <div class="mb-2 p-3 bg-red-50 border border-red-200 rounded-lg">
              @for (error of getFieldErrorMessages(field.id); track $index) {
                <div class="text-red-700 text-sm flex items-start">
                  <i class="fas fa-exclamation-circle mt-0.5 mr-2"></i>
                  <span>{{ error }}</span>
                </div>
              }
            </div>
          }

          @switch (field.type) {
          @case ('text') {
          <input type="text" [placeholder]="field.placeholder" [value]="formData()[field.id] || ''"
            (input)="handleInputChange(field.id, $any($event.target).value)" 
            [class]="'w-full form-control ' + (hasFieldError(field.id) ? 'border-red-500' : '')"
            [required]="field.required" />
          }
          @case ('textarea') {
          <textarea [placeholder]="field.placeholder" rows="4" [value]="formData()[field.id] || ''"
            (input)="handleInputChange(field.id, $any($event.target).value)"
            [class]="'w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent ' + (hasFieldError(field.id) ? 'border-red-500' : 'border-gray-300')"
            [required]="field.required"></textarea>
          }
          @case ('radio') {
          <div class="space-y-2">
            @for (option of field.options; track $index) {
            <div class="form-check items-center">
              <input type="radio" [id]="field.id + '-' + $index" [name]="field.id" [value]="option"
                [checked]="formData()[field.id] === option"
                (change)="handleInputChange(field.id, $any($event.target).value)" class="mr-2 form-check-input"
                [required]="field.required" />
              <label [attr.for]="field.id + '-' + $index" class="form-check-label">{{ option }}</label>
            </div>
            }
          </div>
          }
          @case ('checkbox') {
          <div class="space-y-2">
            @for (option of field.options; track $index) {
            <div class="form-check items-center">
              <input type="checkbox" [id]="field.id + '-' + $index" [value]="option"
                [checked]="formData()[field.id]?.includes(option) || false"
                (change)="handleCheckboxChange(field.id, option, $event)" class="mr-2 form-check-input" />
              <label [attr.for]="field.id + '-' + $index" class="form-check-label">{{ option }}</label>
            </div>
            }
          </div>
          }
          @case ('dropdown') {
          <select [value]="formData()[field.id] || ''" (change)="handleInputChange(field.id, $any($event.target).value)"
            [class]="'w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent ' + (hasFieldError(field.id) ? 'border-red-500' : 'border-gray-300')"
            [required]="field.required">
            <option value="">Select an option</option>
            @for (option of field.options; track $index) {
            <option [value]="option">{{ option }}</option>
            }
          </select>
          }
          @case ('rating') {
          <app-star-rating 
            [field]="field" 
            [isEditing]="true" 
            [value]="formData()[field.id] || 0"
            [allowHalfStar]="true"
            (onChange)="handleInputChange(field.id, $event)" />
          }
          @case ('date') {
          <div class="relative">
            <input type="date" [value]="formData()[field.id] || ''"
              (change)="handleInputChange(field.id, $any($event.target).value)" 
              [class]="'w-full form-control pr-10 ' + (hasFieldError(field.id) ? 'border-red-500' : '')"
              [required]="field.required" />
            <i class="fas fa-calendar absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none"></i>
          </div>
          }
          @case ('file') {
          <div class="border-2 border-dashed border-gray-300 rounded-lg p-4 text-center">
            <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
            <p class="text-gray-500">Click to upload or drag and drop</p>
            <input type="file" (change)="handleFileChange(field.id, $event)" class="hidden" [id]="'file-' + field.id"
              [required]="field.required" />
            <label [attr.for]="'file-' + field.id"
              class="inline-block mt-2 bg-primary text-white py-2 px-4 rounded-lg hover:bg-indigo-600 transition-colors cursor-pointer">
              Choose File
            </label>
          </div>
          }
          }
        </div>
        }
      </div>

      <div class="mt-3">
        <button type="submit" class="w-full py-2 px-4 rounded-lg text-white font-medium"
          [style.backgroundColor]="form.theme.primaryColor">
          Submit
        </button>
      </div>
    </form>
  </div>
</div>
}